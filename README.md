软件说明书
1. 软件名称与版本
软件名称：微生物数据分析工具（两两比较）
版本：1.0 (稳定版本)
发布日期：2025年3月

2. 简介
本软件是一款基于HTML和JavaScript的浏览器工具，用于对两个CSV/TSV格式的微生物检测数据进行两两比较分析。用户可以上传两个数据文件以及一个微生物列表文件（包含taxid、name、cn_name），然后选择需要分析的样本、指标（如reads_accum、rpm或abd）和阈值。软件会：

对指定样本的两个数据文件中各病原体数据进行对比，生成对数坐标散点图；
在图表右侧显示当前样本中各病原体在两个文件中的RPM明细；
对所有共同样本的检测数据进行汇总统计，筛选出CSV1中高于CSV2 3倍以上和CSV1中低于CSV2 3倍以上的病原体，并计算其平均RPM值及比值；
提供保存功能，用户可以将当前样本的图表及表格、以及所有样本的统计结果分别保存为PNG图片和CSV文件。
3. 系统需求
操作系统：Windows、macOS、Linux（只需支持现代浏览器即可）
浏览器：支持HTML5和JavaScript的主流浏览器（如Chrome、Firefox、Edge、Safari）
网络要求：无需服务器支持，所有功能均在本地浏览器中运行
4. 安装与运行
下载文件
将完整的HTML代码保存为一个文件（例如：microbial_analysis.html）。

运行程序
双击该HTML文件，或在浏览器中打开该文件，即可启动软件界面。

无需安装其他依赖
程序通过CDN加载了PapaParse和Plotly库，无需额外安装。

5. 功能介绍
5.1 文件上传
数据文件：
用户需上传两个CSV/TSV格式的文件（文件中应包含sample__uid、taxid、rpm及其他定量指标字段）。
程序会从sample__uid中提取样本名称（假定样本名称由字符串的第三和第四部分组成），并自动更新样本下拉框，供后续分析选择。

微生物列表文件：
支持上传一个CSV格式的文件，该文件中至少包含taxid、name和cn_name三列。程序将提取taxid列作为过滤依据，仅对列表中出现的微生物进行后续分析。

5.2 参数设置
阈值：
用户可设置一个数值阈值，只有在指定指标值大于或等于该阈值的数据才会纳入分析。
指标选择：
可选择用于比较的指标（如reads_accum、rpm或abd）。
样本选择：
程序自动计算两个数据文件中共同存在的样本，用户可从下拉框中选择目标样本进行单样本比较。
5.3 单样本比较
图表展示：
对选定样本的数据，程序将以taxid为分组依据，生成对数坐标的散点图，并添加y=x参考线，直观展示两个文件中指标值的差异。图表中每个病原体均采用不同颜色，图例显示病原体的中文名称。
明细表格：
右侧区域显示当前样本中各病原体在两个文件中的RPM值，便于查看细节。
5.4 所有样本汇总统计
统计逻辑：
程序遍历所有共同样本，将每个病原体的检测结果汇总，计算：
出现样本数
CSV1的平均RPM值
CSV2的平均RPM值
两者的比值（若CSV2平均值为0，则比值显示为“∞”）
结果筛选：
汇总后分为两组：
CSV1高于CSV2 3倍以上：比值 ≥ 3的病原体，按比值降序排序
CSV1低于CSV2 3倍以上：比值 ≤ 1/3的病原体，按比值升序排序
统计结果分别在界面下方两个表格中显示。
5.5 保存功能
当前样本保存：
用户点击“保存图像和表格”按钮后，当前样本的图表（PNG格式）和明细表格（CSV格式）将被导出并下载。
所有样本统计保存：
用户点击“保存所有样本统计结果”按钮后，汇总统计结果将导出为CSV文件并下载。
6. 使用步骤
上传数据文件：
在界面上分别上传两个微生物检测数据文件。

上传微生物列表（可选）：
若只关注特定病原体，请上传包含taxid、name、cn_name的微生物列表文件。

设置参数：

输入数值阈值（默认为0）。
从下拉框中选择需要比较的指标。
从样本下拉框中选择一个样本进行单样本比较。
绘制图表：
点击“绘图”按钮，界面左侧显示当前样本的散点图，右侧显示该样本各病原体的RPM明细。

保存当前结果：
如需保存当前样本结果，点击“保存图像和表格”按钮，系统将导出图表PNG及表格CSV文件。

汇总统计：
点击“统计所有样本比较统计”按钮，系统将对所有共同样本数据进行汇总，并在下方显示两组统计结果：

CSV1高于CSV2 3倍以上
CSV1低于CSV2 3倍以上
保存统计结果：
点击“保存所有样本统计结果”按钮，即可将汇总统计结果导出为CSV文件。

7. 输出结果说明
散点图：

横轴：选定指标在文件1中的数值（对数坐标）
纵轴：选定指标在文件2中的数值（对数坐标）
图中各点代表单个病原体，图例显示其中文名称，参考线y=x帮助判断两边数据差异。
当前样本明细表：
显示当前样本中各病原体的中文名称、文件1中的RPM值和文件2中的RPM值。

汇总统计表：
分两组显示满足条件的病原体信息，包括：

病原体中文名称
出现的样本数
CSV1平均RPM值
CSV2平均RPM值
比值（CSV1平均RPM/CSV2平均RPM）
若没有满足条件的病原体，则显示“无满足条件结果”。
8. 常见问题及注意事项
文件格式要求：

数据文件必须包含sample__uid、taxid、rpm以及其他指标字段。
微生物列表文件必须包含taxid列，建议同时包含name和cn_name以便显示更友好的名称。
样本名称提取规则：
软件默认通过“-”分割sample__uid，提取第三和第四部分作为样本名称，若实际数据格式不同，请修改extractSampleName函数。

阈值设置：
阈值用于过滤数据，确保仅对大于或等于该值的数据进行分析，避免过低值对图表显示产生影响。

对数坐标注意事项：
因为对数坐标无法显示0值，程序将0值替换为极小正数（1e-6）。若数据中存在大量0值，请注意结果解释。

浏览器兼容性：
请使用支持现代HTML5和JavaScript的浏览器以获得最佳体验。

9. 版权与联系方式
版权信息：
本软件由杰毅生物开发，版权所有，未经授权不得用于商业用途。
联系方式：
如有疑问或建议，请通过电子邮件联系：hanxu@matridx.com
这份说明书详细介绍了软件的功能、使用步骤、输出结果和常见问题，供用户在使用前了解软件的基本信息和操作流程。你可以根据实际情况进行修改和完善。
